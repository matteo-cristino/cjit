name: cjit
on:
  push:
    paths-ignore:
      - 'docs/**'
      - '*.md'
    branches:
      - main
  pull_request:
    paths-ignore:
      - 'docs/**'
      - '*.md'
    branches:
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

jobs:
  win-native-test:
    name: ðŸªŸ Windows native test
    runs-on: "windows-latest"
    steps:
      - uses: actions/checkout@v4
      # - name: install dependencies
      #   run: |
      #     choco install --no-progress -r -y upx
      - name: Build native windows exe for x86_64
        run: |
          cd .\lib\tinycc
          bash configure --targetos=WIN32 --config-backtrace=no
          make libtcc.a libtcc1.a
          cd ..\..
          make -f build/win-native.mk
      - name: Run tests
        run: |
          .\cjit.exe test\hello.c
